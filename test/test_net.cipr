echo "[TEST] Network Module";

// 1. HTTP
let html = http_get("http://google.com");
if (size(html) < 10) { echo "FAIL: http_get empty"; exit(1); }

// 2. Socket Server
let port = 8899;
let srv = listen(port);
if (srv < 0) { echo "FAIL: listen failed"; exit(1); }

// Background client
run("bash -c 'sleep 0.5; echo ping | nc localhost 8899' > /dev/null 2>&1 &");

let client = accept(srv);
if (client < 0) { echo "FAIL: accept failed"; exit(1); }

let msg = recv(client, 1024);
if (trim(msg) != "ping") { echo "FAIL: recv mismatch"; exit(1); }

close(client);
close(srv);

echo "PASS: Network Module";